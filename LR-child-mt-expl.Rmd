---
title: "Little Rock Child Maltreatment: <br> Exploratory Analysis"
author: "UA Research Team"
date: "June 22, 2019"
output: 
  html_document:
      toc: true
      number_sections: true
      toc_float: true 
      toc_depth: 6
      theme: united
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(results = 'asis',      # This is essential (can also be set at the chunk-level),
               comment = NA,
               echo = FALSE,
               prompt = FALSE,
               cache = TRUE,
               warning = FALSE,
               message = FALSE)
library(summarytools)
st_options(plain.ascii = FALSE,      
           style = "rmarkdown",      # This too
           footnote = NA,             # Avoids footnotes which would clutter the results
           subtitle.emphasis = FALSE  # This is a setting to experiment with - according to 
           )                                     # the theme used, it might improve the headings'
                                      # layout
```

```{r, echo=FALSE}
st_css()                              # This is a must; without it, expect odd layout,
```

# Little Rock Child Maltreatment

## Background

This is an exploratory analysis of data-set that reports child maltreatment incidents in Little rock from June 2015 to June 2018. We show here the kernel density maps for the child maltreatment incidents as well as their distribution over time. We also provide some insights into how the different categories of allegations are associated with each other via finding 'frequent itemset's, and finally, provide correlation structure for showing how child maltreatment relates to a few built environment factor. 

## Map of Incidents 

First we geocode the addresses using Google's API and plot the incidents on a map like a point process using the latitude and longitudes extracted by `ggmap`.

```{r, echo = F}
rm(list = ls())
require(devtools)
# devtools::install_github("dkahle/ggmap", ref = "tidyup")
# devtools::install_github("thomasp85/patchwork")
library(pacman)
p_load("sf"             # Spatial data objects and methods
       ,"mapview"        # Interactive Map Viewing
       ,"ggmap"          # ggplot2 addon for base maps
       ,"cowplot" 
       ,"spatstat"       # KDE and other spatial functions
       ,"raster"         # cell-based spatial operations
       ,"tidyverse"      # data manipulation framework
       ,"Hmisc"          # using cut2(  functions for ggplot legends
       ,"fitdistrplus"   # Distribution fitting functions
       ,"lubridate"      # Power tools for handling dates
       ,"tidycensus" 
       ,"lwgeom" 
       ,"Hmisc" 
       ,"hrbrthemes" 
       ,"gridExtra" 
       ,"spdep"          # KNN functions
       ,"foreach" 
       ,"doParallel" 
       ,"corrplot" 
       ,"ranger"         # randomforest implimentation    
       ,"glmnet"         # for Ridge and Lasso Regression
       ,"knitr"          # for kable table
       ,"kableExtra" 
       ,"FNN"            # KNN for CPS vs. NN plots
       ,"groupdata2" 
       ,"htmltools" 
       ,"viridis" 
       ,"viridisLite")
```

```{r themes, echo = F}
mapTheme <- function() {
  theme(
    plot.title = element_text(size = 14, family = "sans", face = "plain", hjust = 0),
    plot.subtitle=element_text(size = 11, family = "sans", hjust = 0),
    plot.caption=element_text(size = 10, family = "sans", face = "italic", hjust = 0),
    axis.text = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.ticks = element_blank(),
    axis.line = element_blank(),
    legend.title = element_text(size = 10, family = "sans"),
    legend.text = element_text(size = 9, family = "sans"),
    panel.border = element_blank()
  )
}

plotTheme <- function() {
  theme(
    plot.title = element_text(size = 14, family = "sans", face = "plain", hjust = 0),
    plot.subtitle=element_text(size = 11, family = "sans", hjust = 0),
    plot.caption=element_text(size = 10, family = "sans", face = "italic", hjust = 0), 
    axis.title.x = element_text(size = 10, family = "sans", face = "plain", hjust = 1, vjust = -0.5),
    axis.title.y = element_text(size = 10, family = "sans", face = "plain", hjust = 1, vjust = 1),
    axis.text = element_text(size = 9, family = "sans", face = "plain"),
    panel.background = element_blank(),
    panel.grid.minor = element_line(colour = "gray"),
    panel.grid.major = element_line(colour = "gray"),
    axis.ticks = element_blank(),
    legend.title = element_text(size = 10, family = "sans"),
    legend.text = element_text(size = 9, family = "sans"),
    axis.line = element_blank()
  )
}
```

```{R corr_calc, echo = F}
# Get lower triangle of the correlation matrix
get_lower_tri<-function(cormat){
  cormat[upper.tri(cormat)] <- NA
  return(cormat)
}
# Get upper triangle of the correlation matrix
get_upper_tri <- function(cormat){
  cormat[lower.tri(cormat)]<- NA
  return(cormat)
}
## reorder function 
reorder_cormat <- function(cormat){
  # Use correlation between variables as distance
  dd <- as.dist((1-cormat)/2)
  hc <- hclust(dd)
  cormat <-cormat[hc$order, hc$order]
}
```


```{R, echo = F}
# rm(list = ls())
setwd("~/Data/LR-Child")
crime <- read.csv(file="child-mt-accepted.csv", header=T,sep=",",
                  na.strings='NULL')
attach(crime)

crime$STR_NME <- crime$STR_NME %>% as.character %>% str_to_title 
crime$CTY_NME <- crime$CTY_NME %>% as.character %>% str_to_title

full_add <- paste(STR_NBR,STR_NME,STR_SFX_TYP_DESC, ",", 
                        CTY_NME,",", "AR")
# head(full_add)
```

```{r, echo = F, eval = F}
library(ggmap)
register_google(key = "<your key here>")
geocoded_latlon <- geocode(crime$full_add,output="latlon")
geocoded_latlon %>% head()
crime.gc <- cbind(crime, full_add,geocoded_latlon)
write.csv(crime.gc, "LR-child-mt-accepted-geocoded.csv")
```

The original data-set has different city names appearing for the reporting addresses. Hence, for this report, we filter the city names by "Little Rock" and use Little Rock location boundaries boundaries to filter out addresses that are outside LR. The map below shows the incidence points as well as their kernel density estimates as a heatmap, after filtering out the points outside Little Rock.

```{r city_names, fig.asp = 0.6, echo = F}
setwd("C:/Users/jd033/Box/Child Maltreatment/Little Rock Data/CSV")
crime.gc.read <- read.csv(file="CM_geocoded.csv",
                     header=T, sep=",")

library(patchwork)
crime.gc.lr = crime.gc.read %>% 
  filter(lat >= 34.62606 & lat <= 34.82195) %>% 
  filter(lon >= -92.52091 & lon <= -92.15494)

# nrow(crime.gc.lr)

cm.point.plot <- qmplot(lon, lat, data = crime.gc.lr)+plotTheme()+mapTheme()+labs(title = "Child Maltreatment Reports")

cm.dens.plot <- qmplot(lon, lat, data = crime.gc.lr, geom = "point", maptype = "toner-lite", darken = .5, color = I("red"), legend = "topleft") +
  stat_density_2d(aes(fill = ..level..), geom = "polygon", alpha = .5, color = NA) +
  scale_fill_gradient2("Propensity", low = "white", mid = "yellow", high = "red", midpoint = 60)+labs(title = "Kernel Density Map")+plotTheme()+mapTheme()

(cm.point.plot | cm.dens.plot)
```

## Dates of Incidents

```{r CM_counts_yearly_weekly, echo = F}


library(lubridate)
# str(crime.gc)
crime.gc.lr$Incident.Date <-as.character(crime.gc.lr$Referral_Date)

crime.gc.lr$Incident.Date <- as.Date(crime.gc.lr$Incident.Date, format = "%m/%d/%Y" )
crime.gc.lr$IncidentYear <- lubridate::year(ymd(crime.gc.lr$Incident.Date))
crime.gc.lr$IncidentWeek <- lubridate::week(ymd(crime.gc.lr$Incident.Date))


library(dplyr)

crime.yearly.ct <- crime.gc.lr %>% filter(IncidentYear>=2015) %>% group_by(IncidentYear) %>% dplyr::summarise(count = n()) 

crime.weekly.ct <- crime.gc.lr %>% filter(IncidentYear>=2015) %>% group_by(IncidentYear, IncidentWeek ) %>%
  dplyr::summarise(count = n())

```

### Weekly Counts 

The following figure shows the weekly and yearly child maltreatmnet incidence counts by years over the study period, that goes from June 2015 to June 2018. 

```{R weekly, fig.asp = 0.5, fig.align = 'center', echo = F}
library(ggplot2)
cm.weekly.plot <- ggplot(crime.weekly.ct, aes(x = IncidentWeek, y = count, group = as.factor(IncidentYear), colour = as.factor(IncidentYear)))+
geom_line(stat = "identity")+geom_bar(alpha = 0.2,stat = "identity")+ylab("Incident Count")+
  xlab("Weeks") + labs(title = "Counts by Month-Year")+
  facet_grid(IncidentYear~.,scales="free_y")+
  theme(legend.position="right")+plotTheme()

cm.yearly.plot <- ggplot(crime.yearly.ct, aes(x = IncidentYear, y = count))+
  geom_bar(stat="identity") +ylab("Incident Count")+
  xlab("Years") +labs(title = "Yearly Counts") +
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
    theme(legend.position="right")+plotTheme()

cm.yearly.plot+cm.weekly.plot
```


### Animated Map 

This animation shows how the incidents moved over time - the animation shows the points on the map of LR over years from 2015 to 2018. **Note that both 2015 and 2018 had fewer events as the data reports only one half of the full year, it does not imply a lower rate of child maltreatment events.** 


```{R animated_map, fig.asp = 0.5}
library(gganimate)
crime.ct.yr <- crime.gc.lr %>% filter(IncidentYear>=2015) %>% group_by(lon, lat, IncidentYear) %>% 
  dplyr::summarise(count = n()) 
p <- qmplot(lon, lat, data = crime.ct.yr, maptype = "toner-lite", color = I("red"))+plotTheme()+mapTheme()

p<- p + geom_point(aes(x = lon, y = lat, size = count),
             data = crime.ct.yr, colour = 'purple', alpha = .7) +
  labs(title = 'Year: {frame_time}', x = 'lon', y = 'lat') +
  transition_time(IncidentYear) 

animate(p, fps = 1, nframes = 4)
```


# Exploratory Analysis: Frequent Itemset Mining 

The child maltreatment data that we have has a number of binary variables with different types of allegations. A first step of understanding the pattern of these different categories is to investigate which ones of these categories or sub-types of child maltreatment co-occur and which ones are more exclusive. Towards this, we use a  data mining technique called the "frequent Item Set Mining" which is typically used in market basket analysis, click stream analysis, or web link analysis. This method aims at finding regularities in a binary occurence matrix: which is then used to find patterns in the shopping behavior of customers of supermarkets, mail-order companies, on-line shops etc.

More specifically, it is used to  __find sets of products that are frequently bought together__. The patterns that are uncovered are expressed as association rules, for example: If a customer buys **bread and wine**, then she/he will probably also buy **cheese**. 
    
### Building Blocks

Formally, our goal here is to identify "building blocks" for child maltreatment from the binary incidence variable, observed as an $m \times n$ sparse binary matrix, where $m,n$ denote the number of observations and number of different allegations/events respectively. The idea here is to think of this data as a transaction data, where each sample represent a transaction and each cause an item. In the language of `itemset mining', we have an item set $I$ and a trasaction set $D$, and each transaction in $D$ contains a subset of the items in $I$. In our case, each subject might have 1's on a subset of the list of columns. 

First, we define some preliminaries and terminologies for explaining the results. 
__Please note that, these are terminologies developed by the researchers in data-mining and computer science, so a "rule" does not imply any causal link__

  - A *rule* $X \Rightarrow Y$ implies $X, Y \in I$ and $X \cap Y = \phi$, where $X$ is called RHS or 'antecedent', and 'Y' is called 'consequent'. 
  -  The **support** $supp(X)$ of a itemset (think, cause-set) $X$ is defined as the proportion of samples in the data set which contain the item-set. 
  -  The **confidence** of a rule is defined $conf(X \Rightarrow Y ) = supp(X \cup Y )/supp(X)$, and mimics the conditional probability $P(Y \mid X)$.
  -  A third interest measure *lift* is defined as $lift(X \Rightarrow Y) = supp(X \cup Y )/(supp(X)\times supp(Y))$, which gives deviation of the support of the rule $X \Rightarrow Y$ from the support expected under independence - i.e. **higher lift means higher association**. 

An **association rules** is a rule that surpasses a user-specified **minimum support** and **minimum confidence** threshold, and to select the interesting association rules we impose further filter the rules (or rank them) by an additional interest measure - e.g. lift. There are other measures of interest such as Chi-square measure, conviction and leverage but we will skip them for the sake of simplicity. 

### Item Frequency Plot 

To see which items are important in the data set we can use the `itemFrequencyPlot`. To reduce the number of items, we only plot the item frequency for items with a support greater than 5% (using the parameter support). 


```{r, echo = F}
library(arules)
library(arulesViz)
crime.lr <- as(as.matrix(crime.gc.lr[,10:130]),"transactions")
itemFrequencyPlot(crime.lr, support = 0.05)
```

## Association rules using the Apriori algorithm

We find all rules with a minimum support of 1% and a confidence of 0.5. This is done using the `Apriori' algorithm [^1]. In order to identify the interesting association rules is to look at association rules with known relationships, and study their association strengths or measures of interest, such as, lift, confidence, support etc. Table below shows the top rules by "support" and also looks at other measures of interest such as the **chi-square** test of association. To be more specific, from the follwing table, the two sub-categories "Sexual Contact" and "Broad-Allegation-Sexual-Abuse" co-occur on 10% of the total cases, and the corresponding lift measure is 7.23, so these two items co-occur 7 times more often than what to be expected if they were independent. This also reflects in the high value of the chi-square test statistics (3591.31). It appears that the items on the right hand side (Broad allegations) are really broader categories of these rules. 


```{r apriori, message = F, results='hide'}
rules <- apriori(crime.lr, parameter = list(support = 0.06, confidence = 0.9, 
                                         minlen = 1))
toprules <- head(sort(rules, by ="support"),20)
kable(inspect(toprules),digits=4)

interestMeasure(toprules, c("support","lift","chiSquare", "confidence"),crime.lr)
```

## Visualization 

### Graph-based Visulization 

Here we show a few plots to understand these rules better.

**Recall that for a rule $X \Rightarrow Y$, X is called antecedent and Y is called consequent**

This shows the rules (or itemsets) as a graph with items as labeled vertices, and rules (or itemsets) represented as vertices connected to items using arrows. For rules, the LHS items are connected with arrows pointing to the vertex representing the rule and the RHS has an arrow pointing to the item.

```{r}
plot(rules, method="graph", engine = "htmlwidget")
```

From this graph, the three broad allegation categories (neglect, abuse and sexual abuse) constitute the core of the graph and they appear to be the main distinguishing categories and the items on the periphery are the sub-categories associated with them. 

```{R}
crime.gc.neglect <- crime.gc.lr %>% filter(Broad.Alleg...Neglect == 1)

crime.gc.abuse <- crime.gc.lr %>% filter(Broad.Alleg...Abuse == 1)

crime.gc.sexual.abuse <- crime.gc.lr %>% filter(Broad.Alleg...Sexual.Abuse == 1)

cm.neglect.plot <- qmplot(lon, lat, data = crime.gc.neglect, geom = "point", maptype = "toner-lite", darken = .5, color = I("red"), legend = "bottom") +
  stat_density_2d(aes(fill = ..level..), geom = "polygon", alpha = .5, color = NA) +
  scale_fill_gradient2("Propensity", low = "white", mid = "yellow", high = "red", midpoint = 60)+ggtitle("Neglect")+plotTheme()+mapTheme()

cm.abuse.plot <- qmplot(lon, lat, data = crime.gc.abuse, geom = "point", maptype = "toner-lite", darken = .5, color = I("red"), legend = "bottom") +
  stat_density_2d(aes(fill = ..level..), geom = "polygon", alpha = .5, color = NA) +
  scale_fill_gradient2("Propensity", low = "white", mid = "yellow", high = "red", midpoint = 60)+ggtitle("Abuse")+plotTheme()+mapTheme()

cm.sexual.abuse.plot <- qmplot(lon, lat, data = crime.gc.sexual.abuse, geom = "point", maptype = "toner-lite", darken = .5, color = I("red"), legend = "bottom") +
  stat_density_2d(aes(fill = ..level..), geom = "polygon", alpha = .5, color = NA) +
  scale_fill_gradient2("Propensity", low = "white", mid = "yellow", high = "red", midpoint = 60)+ggtitle("Sexual Abuse")+plotTheme()+mapTheme()

(cm.neglect.plot + cm.abuse.plot) / cm.sexual.abuse.plot



```

# Built Environment Factors 

Here we show the correlation patterns for child maltreatment counts within 500 ft grid cells and a number of built environment factors. The factors considered here are shown below, with their basic summary statistics for the grid-level counts. 

```{r read_500ft, echo = F, results = 'hide'}
cm_lr_500ft = st_read("C:/Users/jd033/Box/Child Maltreatment/Little Rock Data/Grid_withFactors/CM_LR_500ft_Factors.shp") 

# cm_lr_500ft %>% st_drop_geometry() %>% summary() %>% kable(digits = 2, caption = "Summary of Built Environment Factors")
```

```{r summary_factors, echo = F}
library(summarytools)
st_options(dfSummary.na.col = FALSE)
dfSummary(cm_lr_500ft %>% st_drop_geometry(), plain.ascii = FALSE, style = "grid", 
          graph.magnif = 0.75, valid.col = FALSE, tmp.img.dir = "/tmp")
```

Figure 2.2 shows the correlation matrix. 

```{r plot_corrmap_factors, echo = F}
library(reshape2)
cm_lr_factors <- cm_lr_500ft %>% st_drop_geometry()
cormat <- round(cor(cm_lr_factors),2)

# Reorder the correlation matrix 
# cormat <- reorder_cormat(cormat)
upper_tri <- get_upper_tri(cormat)

# melted_cormat <- melt(cormat)
# Melt the correlation matrix
melted_cormat <- melt(upper_tri, na.rm = TRUE)

# Create a ggheatmap
ggheatmap <- ggplot(melted_cormat, aes(Var2, Var1, fill = value))+
  geom_tile(color = "white")+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1,1), space = "Lab", 
                       name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
  theme(axis.text.x = element_text(angle = 45, vjust = 1, 
                                   size = 12, hjust = 1))+
  coord_fixed()
ggheatmap + 
  geom_text(aes(Var2, Var1, label = value), color = "black", size = 4) +
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    panel.grid.major = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank(),
    axis.ticks = element_blank(),
    legend.justification = c(1, 0),
    legend.position = c(0.6, 0.7),
    legend.direction = "horizontal")+
  guides(fill = guide_colorbar(barwidth = 7, barheight = 1,
                               title.position = "top", title.hjust = 0.5)) + labs(title = "Correlation between Built Environment Factors",
       caption = "Figure 3.1")


```

## Maps for Built Environment Factors 


![Child Maltreatment Reports by 500-ft grids](CM_Counts_2.png)

![Banks by 500-ft grids](Banks-2.png)


![Liquor Stores by 500-ft grids](LiqStore-2.png)

![Hotels by 500-ft grids](Hotels-2.png)


# ACS variables: tract level correlations 

Next, we look at how child maltreatment counts correlate with a few selected ACS variables at the tract level. The variables shown in the map below are as follows, grouped by the direction of the correlation coefficient. 
Figure 3.2 shows the heatmap, where the variables are clustered by a hierarchical clustering algorithm where variables strongly correlated are clustered together. 

**Positive Correlation with child maltreatment counts**

     1. Population size (NL) 
     2. Population density (p = .052) 
     3. % Under 18 
     4. % Black 
     5. % Non-White 
     6. % Hispanic 
     7. % Non-Married Family Households 
     8. % Female Headed Households 
     9. % Single Parent Households 
    10. % Low Education level (less than high school) 
    11. % Renter Occupied 
    12. % Population under 18 in poverty 
    13. % Population struggling 
    14. % Not insured 
    15. % On public insurance 
    16. % Households with High household cost 
  
**Negative Correlation with child maltreatment counts**

    1. % Population with a College Education 
    2. % Own their home 


```{r acs_correlates, echo = F}
library(foreign)
fname <- "USE_Reduced_LR Tract Data_ACS and Malreatment Counts_.sav"


setwd("C:/Users/jd033/Box/Child Maltreatment/Little Rock Data/SPSS")

lr_tract_acs = read.spss(fname,to.data.frame = TRUE)

lr_tract_acs_select = lr_tract_acs %>% dplyr::select(Incident_Count_sum, NLTotPop, PopDensity,Perc_Under18,Perc_Black, Perc_NonWhite, Perc_Hispanic, Perc_NonMarr_Fam_HH, Perc_FHH,Perc_SingPrnt_HH,PercLowEduc, Perc_RenterOcc, 
Perc_PopUnder18inPov, Perc_PopStrugg, Perc_NotInsured, Perc_PublicInsure, 
PercHighHHCost, PercCollEduc, Perc_OwnHome)

cormat <- round(cor(lr_tract_acs_select),2)

library(reshape2)
# melted_cormat <- melt(cormat)
# Get lower triangle of the correlation matrix

# Reorder the correlation matrix 
cormat <- reorder_cormat(cormat)
upper_tri <- get_upper_tri(cormat)

# melted_cormat <- melt(cormat)
# Melt the correlation matrix
melted_cormat <- melt(upper_tri, na.rm = TRUE)

# Create a ggheatmap
ggheatmap <- ggplot(melted_cormat, aes(Var2, Var1, fill = value))+
  geom_tile(color = "white")+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1,1), space = "Lab", 
                       name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
  theme(axis.text.x = element_text(angle = 45, vjust = 1, 
                                   size = 10, hjust = 1))+
  coord_fixed()+plotTheme()
(ggheatmap + 
  geom_text(aes(Var2, Var1, label = value), color = "black", size = 2) +
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    panel.grid.major = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank(),
    axis.ticks = element_blank(),
    legend.justification = c(1, 0),
    legend.position = c(0.6, 0.7),
    legend.direction = "horizontal")+
  guides(fill = guide_colorbar(barwidth = 7, barheight = 1,
                               title.position = "top", title.hjust = 0.5)) + labs(title = "Correlation between ACS variables", caption = "Figure 3.2"))
```

## Maps 

The following maps shows the spatial distribution of a few selected variables that are correlated with the child maltreatment counts at the tract level as well as the rate defined as the ratio of count of child maltreatment reports to the total population size (NL). 

```{r acs_maps}

cm_lr_acs = read_sf("C:/Users/jd033/Box/Child Maltreatment/Little Rock Data/SocialMeasures/LR_Tracts_ACS_Data_CM_Counts.shp") 
#%>% st_transform(crs = 2765)


p1 <- cm_lr_acs %>%
  ggplot(aes(fill = Incident_C/NLTotPop)) + 
  geom_sf(color = NA) + 
  coord_sf(crs = 2765) + 
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "Incident Counts / Pop. size (NL)")+mapTheme()

p2 <- cm_lr_acs %>%
  ggplot(aes(fill = PercHighHH)) + 
  geom_sf(color = NA) + 
  coord_sf(crs = 2765) + 
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "%High Household Cost")+mapTheme()

p3 <- cm_lr_acs %>%
  ggplot(aes(fill = PercLowEdu)) + 
  geom_sf(color = NA) + 
  coord_sf(crs = 2765) + 
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "% Low Education Level")+mapTheme()

p4 <- cm_lr_acs %>%
  ggplot(aes(fill = PercCollEd)) + 
  geom_sf(color = NA) + 
  coord_sf(crs = 2765) + 
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "% College Education")+mapTheme()

(p1 | p2) / (p3 | p4 )

# library(grid); library(gridExtra)
# (p.comb <- grid.arrange(p1,p2,p3,p4, ncol = 2))
```

```{r}
### Second Set 

p1 <- cm_lr_acs %>%
  ggplot(aes(fill = Perc_FHH)) + 
  geom_sf(color = NA) + 
  coord_sf(crs = 2765) + 
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "% Female Headed Household")+mapTheme()

p2 <- cm_lr_acs %>%
  ggplot(aes(fill = Perc_PopSt)) + 
  geom_sf(color = NA) + 
  coord_sf(crs = 2765) + 
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "% Population Struggling")+mapTheme()

p3 <- cm_lr_acs %>%
  ggplot(aes(fill = Perc_NotIn)) + 
  geom_sf(color = NA) + 
  coord_sf(crs = 2765) + 
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "% Not Insured")+mapTheme()

p4 <- cm_lr_acs %>%
  ggplot(aes(fill = Perc_Publi)) + 
  geom_sf(color = NA) + 
  coord_sf(crs = 2765) + 
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "% On Public Insurance")+mapTheme()

(p1 | p2) / (p3 | p4 )
```

```{r}
p1 <- cm_lr_acs %>%
  ggplot(aes(fill = Perc_Under)) + 
  geom_sf(color = NA) + 
  coord_sf(crs = 2765) + 
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "% under 18")+mapTheme()

p2 <- cm_lr_acs %>%
  ggplot(aes(fill = Perc_Black)) + 
  geom_sf(color = NA) + 
  coord_sf(crs = 2765) + 
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "% Black")+mapTheme()

p3 <- cm_lr_acs %>%
  ggplot(aes(fill = Perc_NonWh)) + 
  geom_sf(color = NA) + 
  coord_sf(crs = 2765) + 
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "% Non-White")+mapTheme()

p4 <- cm_lr_acs %>%
  ggplot(aes(fill = Perc_Hispa)) + 
  geom_sf(color = NA) + 
  coord_sf(crs = 2765) + 
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "% Hispanic")+mapTheme()

(p1 | p2) / (p3 | p4 )
```



## Footnotes 

[^1]: The Apriori Algorithm [https://en.wikipedia.org/wiki/Apriori_algorithm]. " proceeds by identifying the frequent individual items in the database and extending them to larger and larger item sets as long as those item sets appear sufficiently often in the database."


