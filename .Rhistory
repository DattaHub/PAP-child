options(expressions= 100000)
options(expressions= 100000)
names(lr_cm_acs)
names(cm_lr_acs)
cm_lr_acs = read_sf("C:/Users/jd033/Box/Child Maltreatment/Little Rock Data/SocialMeasures/LR_Tracts_ACS_Data_CM_Counts.shp")
rm(list = ls())
if(T){
library("sf")            # Spatial data objects and methods
library("mapview")       # Interactive Map Viewing
library("ggmap")         # ggplot2 addon for base maps
library("cowplot")
library("spatstat")      # KDE and other spatial functions
library("raster")        # cell-based spatial operations
library("tidyverse")     # data manipulation framework
library("Hmisc")         # using cut2() functions for ggplot legends
library("fitdistrplus")  # Distribution fitting functions
library("lubridate")     # Power tools for handling dates
library("tidycensus")
library("lwgeom")
library("Hmisc")
library("hrbrthemes")
library("gridExtra")
library("patchwork")
library("spdep")         # KNN functions
library("foreach")
library("doParallel")
library("corrplot")
library("ranger")        # randomforest implimentation
library("glmnet")        # for Ridge and Lasso Regression
library("knitr")         # for kable table
library("kableExtra")
library("FNN")           # KNN for CPS vs. NN plots
library("groupdata2")
library("htmltools")
library("viridis")
library("viridisLite")
}
mapTheme <- function() {
theme(
plot.title = element_text(size = 14, family = "sans", face = "plain", hjust = 0),
plot.subtitle=element_text(size = 11, family = "sans", hjust = 0),
plot.caption=element_text(size = 10, family = "sans", face = "italic", hjust = 0),
axis.text = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks = element_blank(),
axis.line = element_blank(),
legend.title = element_text(size = 10, family = "sans"),
legend.text = element_text(size = 9, family = "sans"),
panel.border = element_blank()
)
}
plotTheme <- function() {
theme(
plot.title = element_text(size = 14, family = "sans", face = "plain", hjust = 0),
plot.subtitle=element_text(size = 11, family = "sans", hjust = 0),
plot.caption=element_text(size = 10, family = "sans", face = "italic", hjust = 0),
axis.title.x = element_text(size = 10, family = "sans", face = "plain", hjust = 1, vjust = -0.5),
axis.title.y = element_text(size = 10, family = "sans", face = "plain", hjust = 1, vjust = 1),
axis.text = element_text(size = 9, family = "sans", face = "plain"),
panel.background = element_blank(),
panel.grid.minor = element_line(colour = "gray"),
panel.grid.major = element_line(colour = "gray"),
axis.ticks = element_blank(),
legend.title = element_text(size = 10, family = "sans"),
legend.text = element_text(size = 9, family = "sans"),
axis.line = element_blank()
)
}
mapviewOptions(basemaps = c("Stamen.TonerLite", "OpenStreetMap.DE"))
base_dir = "C:/Users/jd033/Box/Child Maltreatment"
fishnet_grid_dim = 1000
k_direction = 8 # 4 = rook, 8 = queen
k_nearest_neighbors = 5
# Either k (e.g. 5 or 10) or "LOOCV"
n_folds = "LOOCV"
# threshold quntile for statArea grouping
stat_area_quantile = 0.60
# Number of simulations for CPS vs. NN
simulations = 1000
# Number of neighbors for CPS vs. NN
k = 5
# random seed
set.seed(11235)
cm_lr_acs = read_sf("C:/Users/jd033/Box/Child Maltreatment/Little Rock Data/SocialMeasures/LR_Tracts_ACS_Data_CM_Counts.shp")
# Class
class(cm_lr_acs)
# Dimensions
dim(cm_lr_acs)
# Info in shapefile
names(cm_lr_acs)
p1 <- cm_lr_acs %>%
ggplot(aes(fill = Perc_FHH)) +
geom_sf(color = NA) +
coord_sf(crs = 2765) +
scale_fill_viridis_c(option = "plasma") +
labs(title = "% Female Headed Household")+mapTheme()
p2 <- cm_lr_acs %>%
ggplot(aes(fill = Perc_PopSt)) +
geom_sf(color = NA) +
coord_sf(crs = 2765) +
scale_fill_viridis_c(option = "plasma") +
labs(title = "% Population Struggling")+mapTheme()
p3 <- cm_lr_acs %>%
ggplot(aes(fill = Perc_NotIn)) +
geom_sf(color = NA) +
coord_sf(crs = 2765) +
scale_fill_viridis_c(option = "plasma") +
labs(title = "% Not Insured")+mapTheme()
p4 <- cm_lr_acs %>%
ggplot(aes(fill = Perc_Publi)) +
geom_sf(color = NA) +
coord_sf(crs = 2765) +
scale_fill_viridis_c(option = "plasma") +
labs(title = "Incident Counts / Pop. size (NL)")+mapTheme()
(p1 | p2) / (p3 | p4 )
(p1 | p2) / (p3 | p4 )
p1 <- cm_lr_acs %>%
ggplot(aes(fill = Perc_Under)) +
geom_sf(color = NA) +
coord_sf(crs = 2765) +
scale_fill_viridis_c(option = "plasma") +
labs(title = "% under 18")+mapTheme()
p2 <- cm_lr_acs %>%
ggplot(aes(fill = Perc_Black)) +
geom_sf(color = NA) +
coord_sf(crs = 2765) +
scale_fill_viridis_c(option = "plasma") +
labs(title = "% Black")+mapTheme()
p3 <- cm_lr_acs %>%
ggplot(aes(fill = Perc_NonWh)) +
geom_sf(color = NA) +
coord_sf(crs = 2765) +
scale_fill_viridis_c(option = "plasma") +
labs(title = "% Non-White")+mapTheme()
p4 <- cm_lr_acs %>%
ggplot(aes(fill = Perc_Hispa)) +
geom_sf(color = NA) +
coord_sf(crs = 2765) +
scale_fill_viridis_c(option = "plasma") +
labs(title = "% Hispanic")+mapTheme()
(p1 | p2) / (p3 | p4 )
options(expressions= 100000)
library(knitr)
opts_chunk$set(results = 'asis',      # This is essential (can also be set at the chunk-level),
comment = NA,
echo = FALSE,
prompt = FALSE,
cache = TRUE,
warning = FALSE,
message = FALSE)
library(summarytools)
st_options(plain.ascii = FALSE,
style = "rmarkdown",      # This too
footnote = NA,             # Avoids footnotes which would clutter the results
subtitle.emphasis = FALSE  # This is a setting to experiment with - according to
)                                     # the theme used, it might improve the headings'
# layout
setwd("C:/Users/jd033/Box/Child Maltreatment/Little Rock Data/CSV")
crime.gc.read <- read.csv(file="CM_geocoded.csv",
header=T, sep=",")
library(patchwork)
crime.gc.lr = crime.gc.read %>%
filter(lat >= 34.62606 & lat <= 34.82195) %>%
filter(lon >= -92.52091 & lon <= -92.15494)
# nrow(crime.gc.lr)
cm.point.plot <- qmplot(lon, lat, data = crime.gc.lr)+plotTheme()+mapTheme()+labs(title = "Child Maltreatment Reports")
cm.dens.plot <- qmplot(lon, lat, data = crime.gc.lr, geom = "point", maptype = "toner-lite", darken = .5, color = I("red"), legend = "topleft") +
stat_density_2d(aes(fill = ..level..), geom = "polygon", alpha = .5, color = NA) +
scale_fill_gradient2("Propensity", low = "white", mid = "yellow", high = "red", midpoint = 60)+labs(title = "Kernel Density Map")+plotTheme()+mapTheme()
(cm.point.plot | cm.dens.plot)
View(crime.gc.lr)
library(lubridate)
# str(crime.gc)
crime.gc.lr$Incident.Date <- ifelse(as.character(crime.gc.lr$Incident.Date) == "",as.character(crime.gc.lr$Referral.Date),as.character(crime.gc.lr$Incident.Date))
